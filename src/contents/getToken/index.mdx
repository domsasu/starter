---
title: getToken
description: getToken guide for our application.
---

## Overview

The `getToken` server action creates and sets a JWT token for authenticated users. This function is essential for implementing authentication in your Next.js application.

```typescript showLineNumbers
// Server action - getToken
'use server';

import { cookies } from 'next/headers';
import { SignJWT } from 'jose';
import { nanoid } from 'nanoid';

interface TokenPayload {
  userId: string;
  email: string;
  role: 'user' | 'admin';
}

export async function getToken(payload: TokenPayload) {
  const secret = new TextEncoder().encode(process.env.JWT_SECRET);
  
  if (!secret) {
    throw new Error('JWT_SECRET environment variable not set');
  }
  
  const token = await new SignJWT({
    sub: payload.userId,
    email: payload.email,
    role: payload.role,
  })
    .setProtectedHeader({ alg: 'HS256' })
    .setIssuedAt()
    .setExpirationTime('24h')
    .setJti(nanoid())
    .sign(secret);
  
  // Set the cookie
  cookies().set({
    name: 'token',
    value: token,
    httpOnly: true,
    path: '/',
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24, // 24 hours
    sameSite: 'strict',
  });
  
  return token;
}
```

## Prerequisites

Before proceeding, ensure you have the following:

- Node.js installed
- Basic knowledge of command-line interface (CLI)
- A code editor (e.g., VSCode)

## Installation Steps

1. **Clone the Repository**:
   Clone the repository using the following command:

   ```bash showLineNumbers
   git clone https://github.com/your-repo/your-project.git
   ```

2. **Navigate to the Project Directory**:
   Use the `cd` command to navigate to your project directory:

   ```bash showLineNumbers
   cd your-project
   ```

3. **Install Dependencies**:
   Install the required dependencies using npm or yarn:

   ```bash showLineNumbers
   npm install
   # or
   yarn install
   ```

## Client Usage

Here's an example of using the `getToken` function in a login form:

```javascript showLineNumbers
// Usage in login form
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { getToken } from '@/actions/auth';

export default function LoginForm() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const router = useRouter();
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    
    try {
      // Authenticate user (example - in real app, verify credentials)
      const userData = {
        userId: '123',
        email: email,
        role: 'user'
      };
      
      await getToken(userData);
      router.push('/dashboard');
    } catch (err) {
      setError('Failed to login. Please check your credentials.');
    }
  };
  
  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      {error && <div className="text-red-600">{error}</div>}
      
      <div>
        <label htmlFor="email">Email</label>
        <input
          id="email"
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          required
          className="w-full p-2 border rounded"
        />
      </div>
      
      <div>
        <label htmlFor="password">Password</label>
        <input
          id="password"
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          required
          className="w-full p-2 border rounded"
        />
      </div>
      
      <button type="submit" className="w-full py-2 bg-blue-600 text-white rounded">
        Login
      </button>
    </form>
  );
}
```

## Additional Information

For more details, please refer to our official [documentation](#).


<Note title="Remember" type="danger">
  Lorem ipsum dolor sit amet consectetur adipisicing elit Numquam iste dolorum
  tempore consectetur explicabo.
</Note>
